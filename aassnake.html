<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game</title>
  <style>
    /* Game Container */
    #gameContainer {
      width: 400px;
      height: 400px;
      background-color: #02040c;
      display: grid;
      grid-template-columns: repeat(20, 20px);
      grid-template-rows: repeat(20, 20px);
      gap: 1px;
      margin-bottom: 20px;
    }

    /* Snake Body */
    .snakeBodyPixel {
      background-color: #4ce71d;
    }

    /* Food */
    .food {
      background-color: #0e66ca;
    }

    /* Score */
    .scoreBoard {
      font-size: 20px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="scoreBoard">Score: <span id="score">0</span></div>
  <div id="gameContainer"></div>

  <script>
    // ================================
    // Step 2: Game Variables
    // ================================
    const gameContainer = document.getElementById("gameContainer");
    const scoreSpan = document.getElementById("score");

    const gridSize = 20; // 20x20 grid
    let snake = [2,1,0]; // initial snake positions (head at index 0)
    let direction = 1; // right
    let foodIndex = 0;
    let score = 0;
    let intervalTime = 300;
    let timerId;

    // ================================
    // Step 3: Create Game Board
    // ================================
    const squares = [];
    for(let i=0;i<gridSize*gridSize;i++){
      const square = document.createElement('div');
      gameContainer.appendChild(square);
      squares.push(square);
    }

    // ================================
    // Step 4: Start Game
    // ================================
    function startGame(){
      // Reset snake
      snake.forEach(index => squares[index].classList.remove('snakeBodyPixel'));
      snake = [2,1,0];
      snake.forEach(index => squares[index].classList.add('snakeBodyPixel'));

      // Reset food
      squares[foodIndex]?.classList.remove('food');
      generateFood();

      // Reset score
      score = 0;
      scoreSpan.textContent = score;

      // Reset direction and interval
      direction = 1;
      clearInterval(timerId);
      timerId = setInterval(move, intervalTime);
    }

    // ================================
    // Step 5: Generate Food
    // ================================
    function generateFood(){
      do {
        foodIndex = Math.floor(Math.random() * squares.length);
      } while(snake.includes(foodIndex));
      squares[foodIndex].classList.add('food');
    }

    // ================================
    // Step 6: Move Snake
    // ================================
    function move(){
      const tail = snake.pop(); // remove last
      squares[tail].classList.remove('snakeBodyPixel'); 

      const head = snake[0] + direction;

      // Collision check
      if(
        (head < 0 && direction === -gridSize) || // hit top
        (head >= gridSize*gridSize && direction === gridSize) || // hit bottom
        (head % gridSize === 0 && direction === 1 && snake[0] % gridSize === gridSize-1) || // hit right
        (head % gridSize === gridSize-1 && direction === -1 && snake[0] % gridSize === 0) || // hit left
        snake.includes(head)
      ){
        alert(`Game Over! Score: ${score}`);
        return clearInterval(timerId);
      }

      snake.unshift(head);
      squares[head].classList.add('snakeBodyPixel');

      // Eat food
      if(head === foodIndex){
        squares[foodIndex].classList.remove('food');
        squares[tail].classList.add('snakeBodyPixel'); // grow snake
        snake.push(tail);
        score++;
        scoreSpan.textContent = score;
        generateFood();
      }
    }

    // ================================
    // Step 7: Controls
    // ================================
    function control(e){
      if(e.keyCode === 39){ direction = 1; } // right
      if(e.keyCode === 37){ direction = -1; } // left
      if(e.keyCode === 38){ direction = -gridSize; } // up
      if(e.keyCode === 40){ direction = gridSize; } // down
    }
    document.addEventListener('keydown', control);

    // Start the game
    startGame();
  </script>
</body>
</html>
